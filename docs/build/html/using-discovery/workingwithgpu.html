<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with GPUs &mdash; Northeastern University Research Computing 2.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/../css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transferring Data" href="transferringdata.html" />
    <link rel="prev" title="Using srun" href="srun.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/NU_logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Welcome</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../welcome/welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../welcome/gettinghelp.html">Getting Help</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started with Discovery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/get_access.html">Getting Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/connect.html">Connecting to Discovery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware on Discovery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware/hardware_overview.html">Hardware overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/partitions.html">Partitions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software on Discovery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/softwareoverview.html">Software overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/modules.html">Using Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/matlab.html">Working with MATLAB on Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/conda.html">Working with Conda/Miniconda/Anaconda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/spack.html">Using Spack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/r.html">Working with R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/mpi.html">Message Passing Interface (MPI) Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Discovery</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usingslurm.html">Using Slurm</a></li>
<li class="toctree-l1"><a class="reference internal" href="sbatch.html">Using sbatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="srun.html">Using srun</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with GPUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requesting-gpus-with-srun-or-sbatch">Requesting GPUs with <code class="docutils literal notranslate"><span class="pre">srun</span></code> or <code class="docutils literal notranslate"><span class="pre">sbatch</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specifying-a-gpu-type">Specifying a GPU type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-cuda">Using CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-gpus-with-pytorch">Using GPUs with PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-tensorflow">Using TensorFlow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transferringdata.html">Transferring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="globus.html">Using Globus</a></li>
<li class="toctree-l1"><a class="reference internal" href="bashrc.html">Working with your bashrc file</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Understanding storage options</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../storage/discovery_storage.html">Storage Accessible on  Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/general_storage.html">General Data Storage Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Open OnDemand (OOD)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using-ood/introduction.html">Introduction to Open OnDemand (OOD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-ood/fileexplore.html">Using OOD’s File Explorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-ood/interactiveapps.html">Using OOD’s Interactive Apps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Discovery in your classroom</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../classroom/class_use.html">Using Discovery with your class FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Northeastern University Research Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Working with GPUs</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-gpus">
<span id="working-gpus"></span><h1>Working with GPUs<a class="headerlink" href="#working-with-gpus" title="Permalink to this headline"></a></h1>
<p>The Discovery cluster has a number of Graphics Processing Units (GPUs) available, as detailed in the table below.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>GPU Type</p></th>
<th class="head"><p>Number of nodes/GPUs</p></th>
<th class="head"><p>CPU Type</p></th>
<th class="head"><p>RAM per node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>k40m</p></td>
<td><p>16 nodes with 1 GPU each</p></td>
<td><p>E5-2690v3&#64;2.60GHz</p></td>
<td><p>128GB</p></td>
</tr>
<tr class="row-odd"><td><p>k80</p></td>
<td><p>8 nodes with 8 GPUs each</p></td>
<td><p>E5-2680v4&#64;2.40GHz</p></td>
<td><p>512GB</p></td>
</tr>
<tr class="row-even"><td><p>p100</p></td>
<td><p>12 nodes with 4 GPUs each</p></td>
<td><p>E5-2680v4&#64;2.40GHz</p></td>
<td><p>512GB</p></td>
</tr>
<tr class="row-odd"><td><p>v100-pcie</p></td>
<td><p>4 nodes with 2 GPUs each</p></td>
<td><p>AMD EPYC 7351&#64;2.60GHz</p></td>
<td><p>480GB</p></td>
</tr>
<tr class="row-even"><td><p>v100-sxm2</p></td>
<td><p>24 nodes with 4 GPUs each</p></td>
<td><p>Intel Gold 6132&#64;2.60Ghz</p></td>
<td><p>187GB</p></td>
</tr>
<tr class="row-odd"><td><p>t4</p></td>
<td><p>2 nodes with 4 GPUs each</p></td>
<td><p>Intel Gold 6132&#64;2.60Ghz</p></td>
<td><p>187GB</p></td>
</tr>
</tbody>
</table>
<p>These GPUs are available within two partitions, named <code class="docutils literal notranslate"><span class="pre">gpu</span></code> and <code class="docutils literal notranslate"><span class="pre">multigpu</span></code>. Note that partitions on Discovery are not physical partitions, they  are virtual partitions.
The differences between the two partitions are the number of GPUs that you can request per job, as well as the time
limit on each job. Both partitions give you access to all of the above GPU types. See the table below for the differences between the two partitions. See <a class="reference internal" href="../hardware/partitions.html#partition-names"><span class="std std-ref">Partitions</span></a> for more information about all of the partitions on Discovery.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Requires Approval?</p></th>
<th class="head"><p>Time limit (Default/Max)</p></th>
<th class="head"><p>Running Jobs</p></th>
<th class="head"><p>Submitted Jobs</p></th>
<th class="head"><p>Core Limit</p></th>
<th class="head"><p>RAM Limit</p></th>
<th class="head"><p>GPU per job Limit</p></th>
<th class="head"><p>GPU per user Limit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>gpu</p></td>
<td><p>No</p></td>
<td><p>4 hours/8 Hours</p></td>
<td><p>25/250</p></td>
<td><p>50/100</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>multigpu</p></td>
<td><p><strong>Yes</strong></p></td>
<td><p>4 hours/24 Hours</p></td>
<td><p>25/100</p></td>
<td><p>50/100</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>12</p></td>
<td><p>12</p></td>
</tr>
</tbody>
</table>
<p>Anyone with an account on Discovery can use the <code class="docutils literal notranslate"><span class="pre">gpu</span></code> partition. Using <code class="docutils literal notranslate"><span class="pre">`multigpu</span></code> requires an application process, which includes documenting
the need for using <code class="docutils literal notranslate"><span class="pre">multigpu</span></code>. To request temporary access to multigpu for testing or to submit an application for full access, you need to fill out and submit a <a class="reference external" href="https://service.northeastern.edu/tech?id=sc_cat_item&amp;sys_id=0c34d402db0b0010a37cd206ca9619b7">ServiceNow ticket</a>.
After you submit a request, it is evaluated by members of the RC team. This is to ensure that the resources in this partition will be used appropriately.</p>
<section id="requesting-gpus-with-srun-or-sbatch">
<h2>Requesting GPUs with <code class="docutils literal notranslate"><span class="pre">srun</span></code> or <code class="docutils literal notranslate"><span class="pre">sbatch</span></code><a class="headerlink" href="#requesting-gpus-with-srun-or-sbatch" title="Permalink to this headline"></a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">srun</span></code> for interactive mode and <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> for batch mode.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">srun</span></code> example below is requesting 1 node and 1 GPU with 1GB of memory in the <code class="docutils literal notranslate"><span class="pre">gpu</span></code> partition. You must use the <code class="docutils literal notranslate"><span class="pre">--gres=</span></code> option to request a gpu. Note that on the <code class="docutils literal notranslate"><span class="pre">gpu</span></code> partition, you cannot request more than 1 GPU (<code class="docutils literal notranslate"><span class="pre">--gres=gpu:1</span></code>)
or your request will fail.</p>
<p><code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--partition=gpu</span> <span class="pre">--nodes=1</span> <span class="pre">--pty</span> <span class="pre">--export=All</span> <span class="pre">--gres=gpu:1</span> <span class="pre">--mem=1G</span> <span class="pre">--time=00:30:00</span> <span class="pre">/bin/bash</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> example below is the similar to the <code class="docutils literal notranslate"><span class="pre">srun</span></code> example above, except for giving the job a name and directing the output to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --time=0:30:00</span>
<span class="c1">#SBATCH --job-name=gpu_run</span>
<span class="c1">#SBATCH --mem=1G</span>
<span class="c1">#SBATCH --gres=gpu:1</span>
<span class="c1">#SBATCH --output=exec.%j.out</span>
<span class="o">&lt;</span><span class="n">your</span> <span class="n">code</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="specifying-a-gpu-type">
<h3>Specifying a GPU type<a class="headerlink" href="#specifying-a-gpu-type" title="Permalink to this headline"></a></h3>
<p>You can add a specific type of GPU to the <code class="docutils literal notranslate"><span class="pre">--gres=</span></code> option (with either <code class="docutils literal notranslate"><span class="pre">srun</span></code> or <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>). The following example is requesting one k40m gpu:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">gres</span><span class="o">=</span><span class="n">gpu</span><span class="p">:</span><span class="n">k40m</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<p>Note that specifying one type of GPU could result in a longer wait time for that specific resource. For a list of GPU types, refer to the GPU Types column in the table at the top of this page.</p>
</section>
</section>
<section id="using-cuda">
<h2>Using CUDA<a class="headerlink" href="#using-cuda" title="Permalink to this headline"></a></h2>
<p>There are several versions of CUDA on Discovery, as listed below.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cuda</span><span class="o">/</span><span class="mf">9.0</span>
<span class="n">cuda</span><span class="o">/</span><span class="mf">9.2</span>
<span class="n">cuda</span><span class="o">/</span><span class="mf">10.0</span>
<span class="n">cuda</span><span class="o">/</span><span class="mf">10.2</span>
<span class="n">cuda</span><span class="o">/</span><span class="mf">11.0</span>
</pre></div>
</div>
<p>You can always use the <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">avail</span></code> command to check for the latest software versions on Discovery as well.</p>
<p>To add CUDA to your path use <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span></code>. For example, type <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">cuda/10.0</span></code> to load version 10 to your path.</p>
</section>
<section id="using-gpus-with-pytorch">
<h2>Using GPUs with PyTorch<a class="headerlink" href="#using-gpus-with-pytorch" title="Permalink to this headline"></a></h2>
<p>You should use PyTorch with a conda virtual environment if you need to run the environment on the Nvidia GPUs on Discovery.</p>
<p>The following is an example of using a conda virtual environment with PyTorch. Make sure that you are on a GPU node before loading the environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">cuda</span><span class="o">/</span><span class="mf">11.0</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">anaconda3</span><span class="o">/</span><span class="mf">3.7</span>
<span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">pytorch_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.7</span> <span class="n">anaconda</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">pytorch_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">pytorch</span> <span class="n">torchvision</span> <span class="n">torchaudio</span> <span class="n">cudatoolkit</span><span class="o">=</span><span class="mf">11.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">pytorch</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span><span class="s1">&#39;import torch; print(torch.cuda.is_available())&#39;</span>
</pre></div>
</div>
</section>
<section id="using-tensorflow">
<h2>Using TensorFlow<a class="headerlink" href="#using-tensorflow" title="Permalink to this headline"></a></h2>
<p>We recommend that you use CUDA 10.2 with the latest version of TensorFlow.
You can find the compatibility of CUDA and TensorFlow versions at the following website <a class="reference external" href="https://www.tensorflow.org/install/source#gpu">https://www.tensorflow.org/install/source#gpu</a>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">anaconda3</span><span class="o">/</span><span class="mf">3.7</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cuda</span><span class="o">/</span><span class="mf">10.2</span>
<span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">TF_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.7</span> <span class="n">anaconda</span> <span class="c1">#where TF_env is the name of the conda environment</span>
<span class="n">conda</span>  <span class="n">activate</span> <span class="n">TF_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">tensorflow</span><span class="o">-</span><span class="n">gpu</span>
</pre></div>
</div>
<p>If you want to test your environment, first make sure you are on GPU node, then type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import tensorflow as tf;  print(tf.test.is_built_with_cuda())&#39;</span>
</pre></div>
</div>
<p>You should see the result <code class="docutils literal notranslate"><span class="pre">True</span></code> if successful.</p>
<p>To get the name of the GPU, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import tensorflow as tf;  print(tf.test.gpu_device_name())&#39;</span>
</pre></div>
</div>
<p>For example, you should see output like the line below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">physical</span> <span class="n">GPU</span> <span class="p">(</span><span class="n">device</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Tesla</span> <span class="n">K40m</span><span class="p">,</span> <span class="n">pci</span> <span class="n">bus</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">0000</span><span class="p">:</span><span class="mi">0</span><span class="n">b</span><span class="p">:</span><span class="mf">00.0</span><span class="p">,</span> <span class="n">compute</span> <span class="n">capability</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">)</span> <span class="o">/</span><span class="n">device</span><span class="p">:</span><span class="n">GPU</span><span class="p">:</span><span class="mi">0</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="srun.html" class="btn btn-neutral float-left" title="Using srun" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transferringdata.html" class="btn btn-neutral float-right" title="Transferring Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Northeastern University Research Computing.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>